<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<title>打卡系統</title>
</head>
<body>

<h2>打卡系統</h2>

<input id="emp" placeholder="員工編號" value="001">

<br><br>

<button onclick="clock('in')">上班打卡</button>
<button onclick="clock('out')">下班打卡</button>

<script>
const API_BASE = location.origin;

function clock(type) {
  const emp = document.getElementById("emp").value;

  navigator.geolocation.getCurrentPosition(
    pos => {
      fetch(`${API_BASE}/api/clock`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          employee_id: emp,
          type: type,
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        })
      })
      .then(r => r.json())
      .then(d => alert(d.message))
      .catch(() => alert("送出失敗"));
    },
    () => alert("定位失敗")
  );
}
</script>

</body>
</html>
